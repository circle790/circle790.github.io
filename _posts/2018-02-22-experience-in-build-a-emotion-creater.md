---
layout: post
#标题配置
title:  "虽然最终被搁浅，但是内心很服气"
#时间配置
date:   2018-02-14 13:09:00 +0800
categories: WorkingShow
tag: CSS3
---

* content
{:toc}

引言
------------------------
没想到，转战滨江后的第一次发帖竟是总结失败的经验，呜啊～图样图森破！谁又不是从失败中成长的呢。事后自我回顾了整个经过，大部分不太妥当的处理还是由于经验的匮乏导致，所以还是要多看，多做，多总结。

说明
------------------------
正如大家所知，互联网行业蓬勃发展，移动互联网欣欣向荣，手机机型五花八门，这也对前端提出了更高的要求。部分手机在使用系统上有进一步的封装，各类手机在浏览器内核和屏幕分辨率上也有自己的选择，无论是原生前端还是web前端都无不为完美兼容而绞尽脑汁。

总结来说，一款受欢迎的产品即使不那么完美那也必定做到精致，这是我需要努力的方向。

故事
------------------------
大家都知道最近有一款娃儿子旅行的游戏很火热，故事就从这里开始。依旧是一个晴朗的午后，我们一行人吃完午饭回到工位旁闲聊。

"最近朋友圈里面青蛙儿子很火，好多人晒娃儿子的旅行明星片，还有做表情包的呢！"

"真的，我们可以做一个表情制作工具蹭一波热点推广一下我们的产品"

![emotion]({{ '/styles/images/emotion.jpg' | prepend: site.baseurl  }})

**需求**

- 配置多张图片作为选择表情图；
- 表情图指定位置输入文字描述；
- 拼合生成表情图片并保存本地；
- 统计访问量生成量以及分享量。

说干就干，下午搜索了表情生成的技术要求，其核心内容就是将表情图片及录入的文字拼合转化为一张，因为之前了解过有一个[html2canvas插件](http://html2canvas.hertzen.com/)，将制定区域的html转化为canvas在导出图片就好了咩（图样图森破，后来知道根本不是这么实现），这里一开始没有对技术细节充分评估，导致后续一些预料之外的问题。

因为是蹭热点，要求尽可能快，UI设计师小姐姐比较给力，第二天我就拿到页面以及所需图片资源。

实现界面如下(源设计稿比这美观些，这里做叙述需要展示)：

![旅行青蛙表情生成器]({{ '/styles/images/create.jpeg' | prepend: site.baseurl  }})

看到界面时我心里泛起嘀咕，这是一个仿app的页面，下部的选图操作模块看似置底，中部有文本输入调出软键盘，该不会导致置底模块上移。。。

果真如此它上移了，只好使用`position:absolute`来模拟`position:fixed`，然而并没有什么卵用，在部分安卓手机上它依旧孤傲的上移了。

转换思路，使用`display:flex`可以进行竖直方向上的布局,恩～很好，大部分手机上都镇定的排列在底部，然而，有一个古灵精怪的出现，在小米MIX2全面屏手机上表现异常，软键盘弹出后整视口的高度发生改变，`flex`元素高度发生变化，导致`item`溢出视野之外。

退而求其次，采用流式布局自然排列，选图操作模块不置底，这样由于手机屏幕的长宽比例不同，再之不同浏览器菜单栏和工具栏高度预留不同，出现下方空白大和滑动内容才能完整显示的瑕疵（此版本没有上线）。

项目最终被搁浅的还有一个保存生成表情问题，这个就是经验不足功能评估不完全导致。PC端通过连接直接访问base64图片地址将图片保存本地没有问题，但是移动端即使设置强制下载部分浏览器依旧不好使，表现为访问图片或者没有反馈（safari原来是操作方式不同，在长按出现箭头上滑操作触发保存；搜狗浏览器确实无法下载，触发了下载操作但是下载没有进程，一直处于0%）。这一点后来看到几个同类型产品保存为全屏图片，做法是提示用户进行截屏操作，如[2018汪年全家福](http://pupupula.net/spring/?ADTAG=wxin&k=gzhrk&CKTAG=mta_share.share_qrcode)。

最后聊一聊`html2canvas`插件进行截屏操作非常方便，有几个坑点需要注意。首先这个插件的转化操作默认为异步进行，如果需要使用同步，比如在转化之前需要进行一些操作就需要设置`async`为`false`确保操作完成再进行转化；其次，转化过程会导致图片模糊，因为是按照显示大小进行转化，同时原标签元素上的一些细节阴影描边等会有所损失；再次，无法进行精确的大小转化，生成的图片大小必须为整数，如果采用rem相对大小进行布局可能有小数的存在，易导致右下白边，最后如果转化元素设置定位且页面有滑动等行为（后来恢复预定位位置的情况也有可能）根据需要设置`scrollX`和`scrollY`参数。

种种的不精致以及热度的渐冷，此次项目最终搁浅了，但是我的内心是服气的，确实在经验上欠考虑，没有预估到可能出现的问题并且提供合理的建议。后期几款同类型的页面发布出来，我仔细观察了他们的做法，发现他们恰当的避免这些问题。

![QQ蛙蛙明星片]({{ '/styles/images/qqfrog.jpeg' | prepend: site.baseurl  }})

QQ空间中推广的天天P图蛙蛙明星片采用上传图片进行修饰的拼合方式，这里有上传图片的接口浏览器保存图片没有什么问题。

![2018汪年全家福]({{ '/styles/images/wangwang.jpeg' | prepend: site.baseurl  }})

2018汪年全家福则类似小游戏来做，使用[cocos2d-js](http://www.cocos.com/docs/js/)，整体下来就是一个h5小游戏，采用图片组合的方式，创造了无限多的可能性。

![新年祝福语小程序]({{ '/styles/images/2018.jpeg' | prepend: site.baseurl  }})

将近过年时，朋友新年祝福时发来一个新年祝福语小程序很实用，彻底解决了浏览器兼容问题。

总结
---------
有时一个问题涉及的方面可能很广泛，解决的办法很多，只是需要一定的积累，能在预料问题的存在就是另一个水平了。每一次的失败经验都是为了下一次的成功，在不断的总结中获得成长，这也是记下来的初衷。

最终这个活动没能大范围的推广，但是收获却很多，比如了解到一款跨平台的游戏开发引擎**cocos2d-js**,这对于未来说未尝不是好事。


参考
---------
[旅行青蛙表情生成器](http://ypw.163.com/chook/emotion/emotion.html#/emotion)

[QQ蛙蛙明星片](http://tu.qq.com/websites/frogsticker/index.html?from=groupmessage&isappinstalled=0)

[2018汪年全家福](http://pupupula.net/spring/?ADTAG=wxin&k=gzhrk&CKTAG=mta_share.share_qrcode)

---------

